# Lights Out!

ブラウザで動く **Lights Out** パズルゲーム。
通常のゲームモードに加え、GF(4) 有限体を使った**数理解析モード**を搭載。

## 遊び方

`index.html` をブラウザで開くだけで動作します。ビルド不要。

```
open index.html
```

## ゲームルール

グリッド上のセルを選択すると、そのセルと周囲 8 マス（3×3 領域）が反転します。
**全セルを消灯**すればクリア。

## モード

### ゲームモード

通常の Lights Out パズル。盤面サイズは 1〜20 × 1〜20 で自由に設定できます。

| キー | 動作 |
|------|------|
| `h` `j` `k` `l` / 矢印キー | カーソル移動 |
| `Space` / `Enter` | セル反転（3×3） |
| `U` | アンドゥ |
| `R` | 解ける配置でリスタート |
| `S` | 解ける配置にスクランブル |
| `G` | GF(4) 重み表示の切替 |
| `Q` | メニューへ戻る |
| `Y` × 5（1秒以内） | 数理解析モードへ移行（隠しコマンド） |

### 数理解析モード

元の m×n 盤面を外周 1 マスで囲った **(m+2)×(n+2)** の拡張盤面。
右端・下端に各行・各列の **GF(4) 重み和** をリアルタイム表示します。

ゲームモードから移行すると、外周セルが自動的に計算・補完され、
**全行・全列の GF(4) 重み和がゼロ**になる（解法可能な）状態で開始できます。

| キー | 動作 |
|------|------|
| `h` `j` `k` `l` / 矢印キー | カーソル移動 |
| `Space` / `Enter` | セル反転 |
| `T` | 反転モード切替（3×3 ↔ 1マス） |
| `U` | アンドゥ |
| `S` | 内部セルを解ける配置にスクランブル |
| `A` | 任意配置（可解保証なし） |
| `E` | 全消灯 |
| `Q` | メニューへ戻る |
| `Y` | ゲームモードへ戻る |

## GF(4) について

GF(4) = GF(2)[x]/(x² + x + 1) の 4 元体を使い、各セル (r, c) に重み ω^(r+c) を割り当てます。

- 行和 RowSum[r] = Σ_c board[r][c] · ω^(r+c)
- 列和 ColSum[c] = Σ_r board[r][c] · ω^(r+c)

全行・全列の和がすべて **0** であることが、盤面が解法可能であるための（十分）条件になります。

重みの表示色: `0`=グレー、`1`=シアン、`ω`=イエロー、`ω²`=マゼンタ

## ファイル構成

```
index.html
style.css
src/
  core/
    board.js    # 盤面状態・反転ロジック・アンドゥ
    gf4.js      # GF(4) 有限体演算
    solver.js   # 外周補完用 GF(2) 線形方程式ソルバ（ガウス消去法）
  ui/
    game.js     # ゲーム状態管理
    renderer.js # Canvas / DOM 描画
    input.js    # キーボード・タッチ入力
```

## 動作環境

ES6 モジュールをサポートするモダンブラウザ（Chrome、Firefox、Safari 等）。
外部ライブラリ・ビルドツール不要。
